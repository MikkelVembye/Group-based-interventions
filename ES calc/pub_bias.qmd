---
title: "Publication bias testing in Dalgaard et al. (2025)"
date: "Last updated `r format(Sys.time(), '%Y.%m.%d')`"
format:
  html:
    code-fold: true
    code-tools: true
    code-summary: "Show the code"
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
#knitr::opts_chunk$set(eval = FALSE)

options(pillar.sigfig = 4) # ensure tibble include 4 digits
options(tibble.width = Inf)
options(dplyr.print_min = 310)
options(scipen = 10)
options(dplyr.summarise.inform = FALSE) # Avoids summarize info from tidyverse

library(DT)
library(kableExtra)

```

```{r, echo=FALSE}

library(tidyverse)
library(robvis)
library(purrr)
library(metafor)
library(patchwork)
library(clubSandwich)
library(wildmeta)
library(gt)
library(metaselection)

library(puniform)
library(tidyverse) # for tidying
library(janitor)   # for tidying variable names
library(boot)      # for bootstrapping
library(tictoc) 


# Loading in helper function used to calculate effect size and conduct the analysis
source_path <- if (isTRUE(getOption('knitr.in.progress'))) "Helpers.R" else "ES calc/Helpers.R"

source(source_path)
```

```{r, warning = FALSE, message = FALSE, echo = FALSE}
# Loading data set
reintergation_dat <- 
  if (isTRUE(getOption('knitr.in.progress'))) {
    readRDS("reintergation_dat.rds") 
  } else {
    readRDS("ES calc/reintergation_dat.rds")
  }
```
# Data
```{r, eval=FALSE}
reintergation_dat <- readRDS("ES calc/reintergation_dat.rds")
reintergation_dat
```

```{r warning = FALSE, message = FALSE, echo = FALSE}
reintergation_dat |> 
  mutate(
    p_val = 2 * ( 1 - pnorm( abs(gt) / sqrt(vgt) ) )
  ) |> 
  select(
    `Authors (year)` = author_year, N_t, N_c, 
    `Outcome construct` = analysis_plan, gt, vgt, Wgt, p_val, 
    `No protocol` = conventional, `Overall RoB` = Overall
  ) |> 
  kable(digits=3)  |> 
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    font_size = 10
  ) |> 
  scroll_box(width = "100%", height = "300px", fixed_thead = TRUE)
```

# Main Analyses

::: {.panel-tabset}

## Overall average effect
```{r}
reintegration_che_res <- .CHE_RVE(reintergation_dat) 

reintegration_che_res |> 
select(studies:UL, tau:sd_total, I2) |>
gt() |> 
fmt_number(columns = 3:9, decimals = 3) |> 
tab_header(
  title = "Overall average effect size",
  subtitle = "Across all reintegrational outcomes"
) 
```


## Subgroup effects (across type of outcome)
```{r}
reintegration_sce_res <- 
  .SCEp(mod = analysis_plan, data = reintergation_dat) 

reintegration_sce_res |> 
select(Moderator:pval) |> 
gt()|> 
fmt_number(columns = 4:10, decimals = 3) |> 
tab_header(
  title = "Overall average effect sizes",
  subtitle = "Across reintegrational subgroups"
) 
```

:::

# Funnel Plots

::: {.panel-tabset}

## Overall

1

## Alcohol and drug abuse/misuse

2

## Hope, Empowerment & Self-efficacy

3

## Social functioning (degree of impairment)

4

## Wellbeing and quality of life

5

:::
 
 
# References
Dalgaard, N. T., Flensborg Jensen, M. C., Bengtsen, E., Krassel, K. F., & Vembye, M. H. (2025) Group‚Äêbased community interventions to support the social reintegration of marginalised adults with mental illness. A Systematic Review and meta-analysus. *Campbell Systematic Reviews*, 18(3), e1254. https://doi.org/10.1002/cl2.1254

::: {.callout-note icon=false appearance="simple" title="Session Information" collapse=true}

## Session Information

```{r}
#| code-fold: false
sessioninfo::session_info()
```

:::